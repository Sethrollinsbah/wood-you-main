/*
*
*
* NOTICE OF LICENSE
*
* This source file is subject to the Academic Free License (AFL 3.0).
*
*  @author Andrey <byalonovich@bk.ru>
*  @copyright  2015-2020 Andrey & co
*  @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
$(document).on('click','.fticon',function(){

            tinymce.activeEditor.execCommand('mceInsertContent', false, $(this).get(0).outerHTML);
            win.close();
    });

tinymce.PluginManager.add('fontellico', function(editor, url) {
    var html;
     loadJSON(url+'/config.json',function(json) {
       // alert(json.toSource());
        var icons = json.glyphs; // this will show the info it in firebug console
        var prefix = json.css_prefix_text;
        html = '<input id="icon-search-popup" placeholder="Search">';
        for(var key in icons) {
            html +=  '<span class="fticon '+prefix+icons[key].css+'" data-css="'+icons[key].css+'">&#x200B</span>'
        }


    }, function(error){

    });

    function loadJSON(path, success, error)
    {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function()
        {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    if (success)
                        success(JSON.parse(xhr.responseText));
                } else {
                    if (error)
                        error(xhr);
                }
            }
        };
        xhr.open("GET", path, true);
        xhr.send();
    }




    // Add a button that opens a window
    editor.addButton('fontellico', {
            text: '<i>',
            icon: false,
            onclick: function() {
                // Open window
                win = editor.windowManager.open({
                    autoScroll: true,
                    width: 690,
                    height: 500,
                    title: 'Icons',
                    spacing: 20,
                    padding: 10,
                    classes: 'fontawesome-panel',
                    items: [
                        {
                            type: 'container',
                            html: html//'<span class="icon-share"></span>'
                        }
                    ],
                    buttons: [{
                        text: 'Close',
                        onclick: function() {
                            win.close();
                        }
                    }]
                });
            }
    });
     editor.on('init', function() {
        var csslink = url + '/css/fontello.css';

        editor.contentCSS.push(csslink);
    });



});